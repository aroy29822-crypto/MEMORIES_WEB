{% extends "base.html" %}
{% block body %}

<style>
    /* === Background === */
    .feed-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1500&q=80') center/cover no-repeat;
        filter: blur(20px) brightness(0.4);
        transform: scale(1.05);
        z-index: -1;
    }

    /* --- Main memory block styling --- */
    .memory-block {
        width: 100%;
        max-width: 1150px;
        margin: 0 auto 100px auto;
        color: white;
        font-size: 18px;
        line-height: 1.45;
        white-space: pre-line;
        overflow: hidden;
        transform: perspective(800px) rotateY(25deg) translateY(50px);
        transform-origin: left center;
        opacity: 0;
        transition: transform 1s cubic-bezier(0.22, 1, 0.36, 1), opacity 1s ease;
    }

    .memory-block.animate {
        transform: perspective(800px) rotateY(0deg) translateY(0);
        opacity: 1;
        filter: drop-shadow(0 0 25px rgba(255, 220, 130, 0.35));
    }

    /* --- Picture (image/video) styling --- */
    .picture {
        width: 220px;
        height: 220px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(0, 0, 0, .45);
        cursor: pointer;
        transition: transform 0.6s ease, filter 0.6s ease;
    }

    .picture:hover {
        transform: scale(1.05) rotateZ(1deg);
        filter: brightness(1.15);
    }

    /* --- Text --- */
    .memory-text {
        display: block;
        margin-top: 0;
    }

    /* === Mobile Responsive === */
    @media(max-width:700px) {
        .picture {
            width: 120px;
            height: 120px;
            border-radius: 10px;
        }

        .memory-text {
            font-size: 15px;
            line-height: 1.4;
            text-align: justify;
        }

        .memory-left .picture {
            float: left;
            margin-right: 10px;
        }

        .memory-right .picture {
            float: right;
            margin-left: 10px;
        }

        .memory-block {
            margin-bottom: 60px;
        }
    }
</style>

<!-- Background Blur Layer -->
<div class="feed-bg"></div>

<div class="container py-5" style="max-width:1250px;margin:auto;">

    {% if show_popup %}
    <div id="welcome-box"
        style="position: fixed; bottom: 18px; left: 18px; max-width: 240px; background: rgba(0,0,0,.68); color: white; padding: 18px 22px; border-radius: 14px; font-size: 19px; z-index: 9999; animation: slideIn .6s forwards, slideOut .6s forwards 2.6s;">
        Hi {{ firstname }}!<br><small>{{ quote }}</small>
    </div>

    <style>
        @keyframes slideIn {
            from {
                left: -250px;
                opacity: 0;
            }

            to {
                left: 18px;
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                left: 18px;
                opacity: 1;
            }

            to {
                left: 350px;
                opacity: 0;
            }
        }
    </style>
    {% endif %}

    {% for p in docs %}
    <div class="memory-block {% if loop.index0%2==0 %}memory-left{% else %}memory-right{% endif %}" style="clear:both;">
        {% if 'mp4' in p.url or 'webm' in p.url or 'mov' in p.url %}
        <video class="picture"
            style="{% if loop.index0%2==0 %}float:left;margin-right:40px;{% else %}float:right;margin-left:40px;{% endif %}"
            data-full="{{ p.url }}" src="{{ p.url|replace('/upload/','/upload/w_350,h_350,c_fill/') }}" controls
            onclick="zoomMedia(this,true)" loading="lazy"></video>
        {% else %}
        <img class="picture"
            style="{% if loop.index0%2==0 %}float:left;margin-right:40px;{% else %}float:right;margin-left:40px;{% endif %}"
            data-full="{{ p.url }}" src="{{ p.url|replace('/upload/','/upload/w_350,h_350,c_fill/') }}"
            onclick="zoomMedia(this,false)" loading="lazy">
        {% endif %}
        <div class="memory-text">{{ p.desc }}</div>
        <div style="clear:both"></div>
    </div>
    {% endfor %}
</div>

<!-- Feedback Box -->
<div id="feedback-box" style="display:none;margin-top:80px;">
    <form action="/feedback" method="POST">
        <textarea name="msg" placeholder="Feedback..."
            style="width:230px;height:70px;border-radius:8px;padding:8px;"></textarea>
        <button class="btn btn-primary btn-sm mt-2 w-100">Send</button>
    </form>

    <!-- Floating Feedback Button -->
    <button id="feedback-toggle" class="btn btn-outline-info rounded-circle"
        style="position:fixed;bottom:35px;right:35px;width:55px;height:55px;font-size:22px;z-index:9999;">
        ðŸ’¬
    </button>

    <script>
        const toggleBtn = document.getElementById("feedback-toggle");
        const box = document.getElementById("feedback-box");
        toggleBtn.addEventListener("click", () => {
            if (box.style.display === "block") {
                box.style.display = "none";
            } else {
                box.style.display = "block";
                box.style.position = "fixed";
                box.style.bottom = "100px";
                box.style.right = "35px";
                box.style.background = "rgba(0,0,0,0.7)";
                box.style.padding = "10px";
                box.style.borderRadius = "10px";
            }
        });
    </script>
</div>

<!-- Flip Scroll Animation -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("animate");
                } else {
                    entry.target.classList.remove("animate");
                }
            });
        }, { threshold: 0.3 });

        document.querySelectorAll(".memory-block").forEach(block => observer.observe(block));
    });
</script>

{% endblock %}