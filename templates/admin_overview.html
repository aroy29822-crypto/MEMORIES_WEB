{% extends "base.html" %}
{% block body %}

<style>
    .overview-container {
        max-width: 1150px;
        margin: 60px auto;
        color: white;
        animation: slideInFromBottom 0.8s ease forwards;
        opacity: 0;
        transform: translateY(50px);
    }

    @keyframes slideInFromBottom {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .stat-card {
        background: rgba(0, 0, 0, 0.55);
        padding: 25px;
        border-radius: 14px;
        text-align: center;
        min-width: 180px;
        box-shadow: 0 0 20px rgba(0, 0, 0, .3);
        transition: all 0.3s;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 25px rgba(255, 220, 130, 0.4);
    }

    .stat-num {
        font-size: 30px;
        color: #ffd27f;
        font-weight: 700;
    }

    .stats-box {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 35px;
    }

    /* --- user status styles --- */
    ul {
        padding-left: 0;
        list-style: none;
    }

    .user-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 6px 0;
        padding: 6px 0;
        opacity: 0;
        animation: fadeIn 0.6s forwards;
    }

    .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 6px #000;
    }

    .dot.online {
        background: #27ff7e;
        box-shadow: 0 0 8px #27ff7e;
        animation: glow 1.2s infinite alternate;
    }

    .dot.offline {
        background: #888;
        box-shadow: 0 0 6px #444;
    }

    @keyframes glow {
        from {
            opacity: .7;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }

    .last-active {
        font-size: 13px;
        color: #aaa;
    }

    .table-container {
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(10px);
        border-radius: 14px;
        padding: 25px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.35);
    }

    @media(max-width:700px) {
        .stat-card {
            min-width: 140px;
            padding: 15px;
        }

        .stat-num {
            font-size: 24px;
        }
    }
</style>

<div class="overview-container">
    <h2 class="text-center mb-4">Admin Overview Dashboard</h2>

    <div class="stats-box">
        <div class="stat-card">
            <div class="stat-num" id="total-users">{{ total_users }}</div>
            <div>Users</div>
        </div>
        <div class="stat-card">
            <div class="stat-num" id="total-posts">{{ total_posts }}</div>
            <div>Posts</div>
        </div>
        <div class="stat-card">
            <div class="stat-num" id="total-feedback">--</div>
            <div>Feedbacks</div>
        </div>
    </div>

</div>

<script>
    function smoothUpdate(id, content) {
        const el = document.getElementById(id);
        el.style.opacity = "0";
        setTimeout(() => { el.innerHTML = content; el.style.opacity = "1"; }, 250);
    }

    function timeAgo(utcString) {
        const then = new Date(utcString).getTime();
        const now = Date.now();
        const diff = Math.floor((now - then) / 1000);
        if (diff < 10) return "just now";
        if (diff < 60) return diff + "s ago";
        if (diff < 3600) return Math.floor(diff / 60) + "m ago";
        return Math.floor(diff / 3600) + "h ago";
    }

    /*function refreshOverview() {
        fetch("/admin/live_stats").then(res => res.json()).then(data => {
            if (data.error) return;

            document.getElementById("total-users").textContent = data.total_users;
            document.getElementById("total-posts").textContent = data.total_posts;
            document.getElementById("total-feedback").textContent = data.total_feedback;

            const now = Date.now();
            let usersHtml = "";
            (data.all_users || []).forEach(u => {
                const active = u.last_active ? new Date(u.last_active).getTime() : 0;
                const online = (now - active) <= 5000;
                usersHtml += `
              <li class="user-item">
                <span class="dot ${online ? 'online' : 'offline'}"></span>
                ${u.email}
                ${!online ? `<span class="last-active">(${timeAgo(u.last_active)})</span>` : ""}
              </li>`;
            });
            if (!usersHtml) usersHtml = "<li><i>No users yet</i></li>";
            smoothUpdate("online-users", usersHtml);

            const logins = data.recent_logins.map(l => `<li>${l.user} - ${l.action} at ${l.time}</li>`).join('');
            smoothUpdate("recent-logins", logins);
            const uploads = data.recent_uploads.map(p => `<li>${p.owner} uploaded at ${p.time}</li>`).join('');
            smoothUpdate("recent-uploads", uploads);
        }).catch(() => { });
    }

    setInterval(refreshOverview, 5000);
    window.addEventListener("load", refreshOverview);
</script>*/

{% endblock %}