{% extends "base.html" %}
{% block body %}
<div class="container py-4 text-light">
    <h2>Admin â€” Overview</h2>
    <div class="mb-3">
        <strong>Total users:</strong> {{ total_users }} &nbsp; | &nbsp;
        <strong>Total posts:</strong> {{ total_posts }}
    </div>

    <h4>Users</h4>
    <table class="table table-dark table-striped">
        <thead>
            <tr>
                <th>Email</th>
                <th>Created</th>
                <th>Last login</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.email }}</td>
                <td>{{ u.created_at.strftime("%Y-%m-%d %H:%M") if u.created_at else "-" }}</td>
                <td>{{ u.last_login.strftime("%Y-%m-%d %H:%M") if u.last_login else "-" }}</td>
                <td>
                    <a class="btn btn-sm btn-primary" href="{{ url_for('admin_user_profile', email=u.email) }}">View
                        profile</a>
                    <a class="btn btn-sm btn-warning" href="{{ url_for('admin_reset_password', email=u.email) }}">Reset
                        password</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4 class="mt-4">Recent logs (latest 200)</h4>
    <div style="max-height:400px; overflow:auto;">
        <table class="table table-dark table-sm">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for L in logs %}
                <tr>
                    <td>{{ L.time.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                    <td>{{ L.user }}</td>
                    <td>{{ L.action }}</td>
                    <td>{{ L.details }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}